# Healthcare Analytics Lab: OLTP to Star Schema

## ğŸ¥ Project Overview

### The Challenge
This project demonstrates a real-world Data Engineering scenario at **HealthTech Analytics**, where a clinical team built a normalized transactional database (OLTP in 3NF) for daily operations. While excellent for transaction processing, the database struggled with slow analytical queries needed by business stakeholders.

### The Solution
As the Data Engineer, I transformed the operational database into an optimized **Kimball-style Star Schema** (OLAP) for analytics. The project showcases:
- **Performance Analysis**: Identifying bottlenecks in normalized schemas
- **Dimensional Modeling**: Designing facts, dimensions, and bridge tables
- **ETL Development**: Building extract, transform, and load pipelines
- **Query Optimization**: Achieving up to **3x faster** query performance

This mirrors real-world data warehouse development where operational and analytical systems serve different purposes.

---

## ğŸ¯ Business Questions Addressed

1. **30-Day Hospital Readmissions**: Identify patients readmitted within 30 days for quality metrics
2. **Revenue by Medical Specialty**: Calculate total revenue generated by each specialty
3. **Monthly Encounter Trends**: Track patient visits over time for capacity planning
4. **Provider Workload Analysis**: Understand which providers are handling complex multi-diagnosis cases

---

## ğŸ—‚ï¸ Database Architecture

### OLTP Schema (Normalized - 3NF)
The original transactional system uses 8 normalized tables optimized for write operations:

![OLTP ERD Diagram](diagrams/erd_diagram.png)

**Tables**: `patients`, `providers`, `specialties`, `departments`, `encounters`, `diagnoses`, `procedures`, `billing`

**Characteristics**:
- âœ… Minimal data redundancy
- âœ… Excellent for INSERT/UPDATE/DELETE operations
- âŒ Requires multiple joins for analytics
- âŒ Complex date calculations at query time
- âŒ Slow aggregation performance

### Star Schema (Dimensional Model)
The optimized analytical database using dimensional modeling:

![Star Schema Diagram](diagrams/star_schema.png)

**Fact Table**: `fact_encounters` (grain: one row per patient encounter)

**Dimension Tables**: 
- `dim_patient` - Patient demographics
- `dim_provider` - Provider information with specialty
- `dim_department` - Department details
- `dim_date` - Pre-computed date attributes for fast filtering

**Bridge Table**: `bridge_encounter_diagnosis` - Handles many-to-many relationship between encounters and diagnoses

**Characteristics**:
- âœ… Denormalized for fast reads
- âœ… Pre-computed metrics (readmissions, date parts)
- âœ… Optimized for GROUP BY and aggregations
- âœ… Simple queries with fewer joins
- âš ï¸ Some data redundancy (acceptable tradeoff)

---

## ğŸ“Š Performance Improvements

| Business Metric | OLTP Execution Time | Star Schema Time | Speedup |
| :--- | :---: | :---: | :---: |
| **30-Day Readmissions** | Complex Self-Join + Date Math | Pre-computed `is_readmission` flag | **~2.9x Faster** âš¡ |
| **Revenue by Specialty** | 4-Table Join Chain | Denormalized Fact Table | **~1.7x Faster** âš¡ |
| **Monthly Encounter Trends** | Runtime `DATE_FORMAT()` | Pre-computed Date Dimension | **~6% Faster** âš¡ |
| **Multi-Diagnosis Encounters** | Bridge Table Aggregation | Indexed Bridge with COUNT | **Optimized** âš¡ |

---

## ğŸ“‚ Repository Structure

```
â”œâ”€â”€ README.md                          # This file
â”œâ”€â”€ Instruction.txt                    # Original project requirements
â”œâ”€â”€ data/
â”‚   â””â”€â”€ generated_10k_sample_data.sql  # 10,000 sample records for OLTP database
â”œâ”€â”€ diagrams/
â”‚   â”œâ”€â”€ erd_diagram.png                # OLTP normalized schema diagram
â”‚   â””â”€â”€ star_schema.png                # Star schema dimensional model
â”œâ”€â”€ notebooks/
â”‚   â””â”€â”€ healthcare_analytics_exploration.ipynb  # Interactive analysis & benchmarks
â””â”€â”€ deliverables/
    â”œâ”€â”€ star_schema.sql                # DDL + ETL scripts for star schema
    â”œâ”€â”€ star_schema_queries.txt        # Optimized analytical queries
    â”œâ”€â”€ design_decisions.txt           # Dimensional modeling justifications
    â”œâ”€â”€ etl_design.txt                 # ETL strategy & SCD handling
    â””â”€â”€ reflection.md                  # Performance analysis & lessons learned
```

---

## ğŸš€ Getting Started

### Prerequisites
- **Python 3.8+** with Jupyter Notebook support
- **MySQL 8.0+** (or compatible database like MariaDB)
- **Python Packages**: 
  ```bash
  pip install jupyter pandas mysql-connector-python
  ```
  Or if you have a `requirements.txt`:
  ```bash
  pip install -r requirements.txt
  ```

### Step-by-Step Setup

#### 1. Set Up the Database
Start a MySQL server (local installation or Docker):
```bash
# Docker option
docker run --name mysql-healthcare -e MYSQL_ROOT_PASSWORD=password -p 3306:3306 -d mysql:8.0
```

#### 2. Load Sample Data
Connect to MySQL and create the OLTP database:
```bash
mysql -u root -p < data/generated_10k_sample_data.sql
```

#### 3. Run the Interactive Notebook
Open the Jupyter notebook in VS Code or Jupyter Lab:
```bash
jupyter notebook notebooks/healthcare_analytics_exploration.ipynb
```

#### 4. Execute the Analysis
Follow the notebook sections in order:
- **Part 1**: Initialize OLTP database and inspect schema
- **Part 2**: Run business queries on OLTP and capture performance metrics
- **Part 3**: Create star schema and execute ETL
- **Part 4**: Run optimized queries and compare performance

---

## ğŸ“š Key Learnings

### Why Star Schema is Faster
1. **Pre-Aggregation**: Metrics like readmission flags are computed once during ETL
2. **Denormalization**: Fewer joins mean less disk I/O and faster query execution
3. **Dimension Tables**: Pre-computed date parts eliminate runtime calculations
4. **Indexing Strategy**: Foreign keys in fact table are optimized for analytical queries

### Design Decisions
- **Fact Grain**: One row per encounter (not per procedure or diagnosis)
- **Bridge Table**: Handles many-to-many encounter-diagnosis relationship
- **SCD Type 1**: Dimensions use simple overwrite (no historical tracking needed for this use case)
- **Date Dimension**: Includes year, month, quarter for fast time-series analysis

### Trade-offs
- **Storage**: Star schema uses more space due to denormalization (~20-30% increase)
- **ETL Complexity**: Requires periodic refresh to stay synchronized with OLTP
- **Write Performance**: Not optimized for transactional writes (that's what OLTP is for)

---

## ğŸ“„ Documentation

All detailed documentation is in the [`deliverables/`](deliverables/) folder:

- **[star_schema.sql](deliverables/star_schema.sql)**: Complete DDL and ETL implementation
- **[star_schema_queries.txt](deliverables/star_schema_queries.txt)**: All 4 optimized analytical queries
- **[design_decisions.txt](deliverables/design_decisions.txt)**: Rationale for schema design choices
- **[etl_design.txt](deliverables/etl_design.txt)**: ETL architecture and data loading strategy
- **[reflection.md](deliverables/reflection.md)**: Deep dive into performance gains and lessons

---

## ğŸ“ Skills Demonstrated

- âœ… **Database Design**: OLTP vs OLAP architecture patterns
- âœ… **Dimensional Modeling**: Kimball methodology (facts, dimensions, bridges)
- âœ… **SQL Mastery**: Complex joins, window functions, CTEs, performance tuning
- âœ… **ETL Development**: Data extraction, transformation, and loading
- âœ… **Performance Optimization**: Query analysis, indexing, denormalization
- âœ… **Data Analysis**: Using Python + SQL for comparative benchmarking

---

## ğŸ“ License
This project is for educational and portfolio purposes.

---

## ğŸ¤ Contributing
This is a personal learning project, but feedback and suggestions are welcome! Feel free to open an issue or reach out.

---

